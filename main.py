# –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ python-telegram-bot
from telegram import Update  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ö–æ–¥—è—â–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ (—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
from telegram.ext import (
    Application,  # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
    CommandHandler,  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥ (–Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å /)
    MessageHandler,  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    filters,  # –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    ContextTypes,  # –¢–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    ConversationHandler,  # –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
)
from gigachat import GigaChat  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å API GigaChat

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
BOT_TOKEN = "7961345416:AAGtoJgv38bkrJ6NBP1JB_JRlDmrF-Pye4Y"  # –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞
GIGA_API_KEY = "NDE5YjEyZTgtZGM4MC00YTg4LWI4MzQtZWI1MTg0Y2JmODE5OmYyNGQ2YzFiLWQ3OTMtNDc5MC04ZmIwLWZjOTk3NTdlZjJlYQ=="  # API-–∫–ª—é—á GigaChat

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è ConversationHandler
# –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ø—É –¥–∏–∞–ª–æ–≥–∞
(
    WAITING_FOR_PRODUCT,  # –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ—Ç–∑—ã–≤–∞
    WAITING_FOR_FILTER_CATEGORY,  # –û–∂–∏–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
    WAITING_FOR_FILTER_PREFERENCES,  # –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
    WAITING_FOR_FILTER_PRICE,  # –û–∂–∏–¥–∞–Ω–∏–µ —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
) = range(4)  # –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º —á–∏—Å–ª–∞ 0-3 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ GigaChat —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
# verify_ssl_certs=False –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
giga = GigaChat(credentials=GIGA_API_KEY, verify_ssl_certs=False)

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start - –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    await update.message.reply_text(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤—ã–±–æ—Ä—É –∏ –∞–Ω–∞–ª–∏–∑—É —Ç–æ–≤–∞—Ä–æ–≤!\n\n"
        "–Ø –º–æ–≥—É:\n"
        "üîç 1. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã (/otziv)\n"
        "üõí 2. –ü–æ–¥–±–∏—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (/filter)\n\n"
        "–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—É—é –∫–æ–º–∞–Ω–¥—É –∏ —è —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–≥—É! üòä"
    )

async def otziv_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /otziv - –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞"""
    await update.message.reply_text(
        "üìù –•–æ—á–µ—à—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä? –û—Ç–ª–∏—á–Ω–æ!\n"
        "–ü—Ä–∏—à–ª–∏ –º–Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n"
        "'iPhone 15' –∏–ª–∏ 'Xiaomi Redmi Note 12'\n\n"
        "–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ–±–∑–æ—Ä! üîç‚ú®"
    )
    return WAITING_FOR_PRODUCT  # –ü–µ—Ä–µ–≤–æ–¥–∏–º –±–æ—Ç–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞

async def filter_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /filter - –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤"""
    await update.message.reply_text(
        "üõçÔ∏è –î–∞–≤–∞–π –ø–æ–¥–±–µ—Ä–µ–º –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è!\n\n"
        "–î–ª—è –Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n"
        "'—Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã', '–Ω–æ—É—Ç–±—É–∫–∏', '–Ω–∞—É—à–Ω–∏–∫–∏' –∏–ª–∏ '—Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç—ã'\n\n"
        "–Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º! üòä"
    )
    return WAITING_FOR_FILTER_CATEGORY  # –û–∂–∏–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞

async def handle_filter_category(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–µ–¥–µ–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞"""
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ user_data –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö
    context.user_data['category'] = update.message.text
    await update.message.reply_text(
        "üëç –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫–∏–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä?\n\n"
        "–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
        "'—Å —Ö–æ—Ä–æ—à–µ–π –∫–∞–º–µ—Ä–æ–π üì∑', '–∏–≥—Ä–æ–≤–æ–π üéÆ', '–¥–ª—è —Ä–∞–±–æ—Ç—ã üíº', '—Å –¥–æ–ª–≥–∏–º –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–º üîã'\n\n"
        "–ß–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—à–µ—à—å, —Ç–µ–º —Ç–æ—á–Ω–µ–µ –±—É–¥–µ—Ç –ø–æ–¥–±–æ—Ä! üòâ"
    )
    return WAITING_FOR_FILTER_PREFERENCES  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–∂–∏–¥–∞–Ω–∏—é –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

async def handle_filter_preferences(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∂–µ–ª–∞–Ω–∏–π –∫ —Ç–æ–≤–∞—Ä—É"""
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ user_data
    context.user_data['preferences'] = update.message.text
    await update.message.reply_text(
        "üíµ –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏ –±—é–¥–∂–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–æ—Ç–æ–≤ –≤—ã–¥–µ–ª–∏—Ç—å –Ω–∞ –ø–æ–∫—É–ø–∫—É.\n\n"
        "–ù–∞–ø–∏—à–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
        "'10000-50000' –∏–ª–∏ '20000-30000'\n\n"
        "–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ª—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ —Ç–≤–æ–µ–π —Ü–µ–Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏! üí∞"
    )
    return WAITING_FOR_FILTER_PRICE  # –û–∂–∏–¥–∞–µ–º –≤–≤–æ–¥ —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

async def handle_filter_price(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
    try:
        # –ü–∞—Ä—Å–∏–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω
        price_range = update.message.text.split('-')
        min_price = int(price_range[0].strip())  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
        max_price = int(price_range[1].strip())  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        category = context.user_data.get('category', '')
        preferences = context.user_data.get('preferences', '')
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–¥—Ä–æ–±–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ GigaChat
        prompt = (
            f"–ü–æ–¥–±–µ—Ä–∏ 3-5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{category}' "
            f"—Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏: {preferences} "
            f"–∏ –≤ —Ü–µ–Ω–æ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ {min_price}-{max_price} —Ä—É–±–ª–µ–π.\n\n"
            "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
            "1. üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏\n"
            "2. üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏\n"
            "3. üí∞ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞\n"
            "4. üõí –ì–¥–µ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å (–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã)\n"
            "5. ‚≠ê –†–µ–π—Ç–∏–Ω–≥ (–µ—Å–ª–∏ –µ—Å—Ç—å)\n\n"
            "–ë—É–¥—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é."
            "–í —ç—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 2500 —Å–∏–º–≤–æ–ª–æ–≤"
        )
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ GigaChat API
        response = giga.chat(prompt)
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç –æ—Ç GigaChat —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        await update.message.reply_text(
            "üéâ –í–æ—Ç —á—Ç–æ —è –Ω–∞—à–µ–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è!\n\n"
            "üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–±–æ—Ä–∞ –ø–æ —Ç–≤–æ–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:\n\n" +
            response.choices[0].message.content +
            "\n\n–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É—Ç–æ—á–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ (/filter) üòä"
        )
        
    except (ValueError, IndexError):
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ü–µ–Ω—ã
        await update.message.reply_text(
            "‚ùå –û–π, –∫–∞–∂–µ—Ç—Å—è, —Ç—ã –≤–≤–µ–ª —Ü–µ–Ω—É –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –¥–∏–∞–ø–∞–∑–æ–Ω —Ç–∞–∫:\n"
            "'10000-50000' –∏–ª–∏ '20000-30000'\n\n"
            "–î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑! üí™"
        )
        return WAITING_FOR_FILTER_PRICE  # –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ü–µ–Ω—É
    except Exception as e:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫
        await update.message.reply_text(
            "üòî –£–ø—Å! –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫...\n"
            f"–û—à–∏–±–∫–∞: {e}\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ (/filter) –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É!"
        )
    
    return ConversationHandler.END  # –ó–∞–≤–µ—Ä—à–∞–µ–º –¥–∏–∞–ª–æ–≥

async def handle_product(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–∑—ã–≤–∞"""
    tovar = update.message.text  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
    
    try:
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ GigaChat –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–∑—ã–≤–∞
        response = giga.chat(
            f"–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ —Ç–æ–≤–∞—Ä '{tovar}'. –í–∫–ª—é—á–∏ —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:\n"
            "üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞\n"
            "üîπ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n"
            "üîπ –õ—É—á—à–∏–µ –∞–Ω–∞–ª–æ–≥–∏ —Å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º\n"
            "üîπ –ò—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ '‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (4.5/5)'\n\n"
            "–û—Ç–∑—ã–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º –∏ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º,–∞ —Ç–∞–∫ –∂–µ –≤ –Ω–µ–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 2500 —Å–∏–º–≤–æ–ª–æ–≤"
        )
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        await update.message.reply_text(
            "üìä –í–æ—Ç –º–æ–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–∞:\n\n" +
            response.choices[0].message.content +
            "\n\n–ù–∞–¥–µ—é—Å—å, —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—ã–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–π! üòä\n"
            "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä - –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏ /otziv"
        )
    except Exception as e:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        await update.message.reply_text(
            "üòï –£–ø—Å! –ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.\n"
            f"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: {e}\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É!"
        )
    
    return ConversationHandler.END  # –ó–∞–≤–µ—Ä—à–∞–µ–º –¥–∏–∞–ª–æ–≥

async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã –æ—Ç–º–µ–Ω—ã (/cancel)"""
    await update.message.reply_text(
        "üö´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.\n\n"
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ, –ø—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ –æ–¥–Ω—É –∏–∑ –∫–æ–º–∞–Ω–¥:\n"
        "/otziv - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–≤–∞—Ä–∞\n"
        "/filter - –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤\n\n"
        "–Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å! üòä"
    )
    return ConversationHandler.END  # –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥

if __name__ == "__main__":
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Application —Å –Ω–∞—à–∏–º —Ç–æ–∫–µ–Ω–æ–º
    app = Application.builder().token(BOT_TOKEN).build()
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º ConversationHandler –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /otziv
    otziv_conv_handler = ConversationHandler(
        entry_points=[CommandHandler("otziv", otziv_command)],  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –∫–æ–º–∞–Ω–¥–∞ /otziv
        states={
            WAITING_FOR_PRODUCT: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_product)],
        },  # –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        fallbacks=[CommandHandler("cancel", cancel)],  # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã
    )
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º ConversationHandler –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /filter
    filter_conv_handler = ConversationHandler(
        entry_points=[CommandHandler("filter", filter_command)],  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –∫–æ–º–∞–Ω–¥–∞ /filter
        states={
            WAITING_FOR_FILTER_CATEGORY: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_filter_category)],
            WAITING_FOR_FILTER_PREFERENCES: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_filter_preferences)],
            WAITING_FOR_FILTER_PRICE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_filter_price)],
        },  # –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
        fallbacks=[CommandHandler("cancel", cancel)],  # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã
    )
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    app.add_handler(CommandHandler("start", start))  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ /start
    app.add_handler(otziv_conv_handler)  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ü–µ–ø–æ—á–∫–∏ /otziv
    app.add_handler(filter_conv_handler)  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ü–µ–ø–æ—á–∫–∏ /filter
    
    print("ü§ñ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")  # –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    app.run_polling()  # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ polling